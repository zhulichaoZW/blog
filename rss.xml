<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[朱立超的个人博客]]></title><description><![CDATA[个人博客]]></description><link>https://www.zhulichao.club</link><generator>RSS for Node</generator><lastBuildDate>Sun, 22 Jul 2018 09:55:46 GMT</lastBuildDate><item><title><![CDATA[微信服务号开发基础]]></title><description><![CDATA[微信服务号开发其实就是普通的网站开发，只不过其中可调用微信的 js-sdk 使用基于微信的 api，我们的项目中只是使用了支付、隐藏/显示菜单、自定义分享内容的功能，主要是为了支持小程序不能进行 iOS…]]></description><link>https://www.zhulichao.club/wechat-base3/</link><guid isPermaLink="false">https://www.zhulichao.club/wechat-base3/</guid><content:encoded>&lt;div&gt;
          &lt;div
            class=&quot;gatsby-resp-iframe-wrapper&quot;
            style=&quot;padding-bottom: 56.25%; position: relative; height: 0; overflow: hidden;margin-bottom: 2em&quot;
          &gt;
            &lt;iframe src=&quot;https://v.miaopai.com/iframe?scid=SvyHaHOczsp7B6ftW86oqMMz62-h5ai6~Fwp8A__&quot; frameborder=&quot;0&quot; allowfullscreen style=&quot;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
          &quot;&gt;
&lt;/iframe&gt;
          &lt;/div&gt;
          &lt;/div&gt;
&lt;p&gt;微信服务号开发其实就是普通的网站开发，只不过其中可调用微信的 js-sdk 使用基于微信的 api，我们的项目中只是使用了支付、隐藏/显示菜单、自定义分享内容的功能，主要是为了支持小程序不能进行 iOS 支付的问题。由于一部分功能是在小程序中的，就需要小程序与服务号的互相跳转。服务号可通过菜单的定义、长按图片识别二维码跳转到小程序，由于小程序内部只能识别小程序码，不能直接跳转到服务号，只能使用图片+文字引导的方式让用户自己进入服务号。&lt;/p&gt;
&lt;h2&gt;在线工具&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://mp.weixin.qq.com/debug/cgi-bin/sandbox?t=sandbox/login&quot;&gt;公众平台测试账号&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://mp.weixin.qq.com/debug&quot;&gt;微信公众平台接口调试工具&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://mp.weixin.qq.com/debug/cgi-bin/sandbox?t=jsapisign&quot;&gt;微信 JS 接口签名校验工具&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;开发环境&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;扫码登录&lt;a href=&quot;https://mp.weixin.qq.com/debug/cgi-bin/sandbox?t=sandbox/login&quot;&gt;公众平台测试账号&lt;/a&gt;。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;接口配置信息，URL 为后端地址，如“&lt;a href=&quot;http://lichao-server.example/api/weixin%E2%80%9D&quot;&gt;http://lichao-server.example/api/weixin”&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;JS接口安全域名，前端域名，如“lichao.example”&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;体验接口权限表中，网页服务/网页账号，修改网页授权获取用户基本信息为后端域名，如“lichao-server.example”&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;后端需要 appID、appsecret、Token 进行微信授权、微信支付等操作&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;如果是前后端分离的，后端需要设置跨域&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;如果是前后端分离的，后端需要设置 cookie 在指定域名下的共享&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;
      &lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;as&lt;/span&gt; cors &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;cors&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// 跨域设置，origin 为前端地址&lt;/span&gt;
app&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;use&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;cors&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;origin&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;origin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; cb&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token function&quot;&gt;cb&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;undefined&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; server&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;whitelist&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;includes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;origin&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    credentials&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// 共享 cookie 设置，server.domain 为前后端都可使用的域名&lt;/span&gt;
app&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;use&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;session&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    store&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;connectRedis&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;session&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; client&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; redis &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    name&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;sid&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    resave&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    saveUninitialized&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    secret&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; server&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;sessionSecret&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    cookie&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; maxAge&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;30&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;24&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;60&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;60&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; domain&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; server&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;domain &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;前端需要 appID 执行 wx.config 进行 js-sdk 签名&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;真机调试&lt;/h2&gt;
&lt;p&gt;使用手机微信打开网页就是线上运行的效果，但这样不能使用 localhost 或 127.0.0.1 的地址，需要内网穿透工具进行本地端口映射，然后通过穿透的地址访问，可以使用 &lt;a href=&quot;https://ngrok.com/&quot;&gt;ngrok&lt;/a&gt;，但是有些慢，还是建议团队搭建完善的开发环境。&lt;/p&gt;
&lt;p&gt;可使用&lt;a href=&quot;https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html&quot;&gt;微信开发者工具&lt;/a&gt;或&lt;a href=&quot;https://mp.weixin.qq.com/wiki?t=resource/res_main&amp;#x26;id=mp1455784140&quot;&gt;微信web开发者工具&lt;/a&gt;进行调试。打开微信web开发者工具可能会报错，一直点确定就打开了。微信web开发者工具可进行移动调试，但需要注意，它在 Network 中显示的请求可能不准确，个人认为是过滤掉了微信内部的请求。以下为授权操作的请求对比。&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/error-a95574b88827950db1a22f06bf11eb2b-21105.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; ; max-width: 700px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 40.952380952380956%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABvElEQVQoz3WRv2/aQBiGPVf9qzp16T/Tte0YqUO3LB2SgUpJFNRUQOJAIEDVdCiQsiB+CINtDMLY2Bi3OBAa6endoUTq0OHRe/fd+f3e76yZA5PhYMjAGDA0hphDk5E9wjItbGuEYztPjEc7lecS27TV3hLfSB+J5rou8/mcOFqyWCxwpy6GYTAeTzBNk263S6fTUbTbbXq9HkbfoN/vY9u2qHeZTqfMhI/00pLVilK5yus379j/eKAMj4+POD1Nc/b5jOvSNRe6Tj6fJ5c7p1Iuc/PthnKlSqvV4qpYFEYzwjAkCAK0h4c/7O19QHv+jBcvX4lOM5WiVquJFAbb7Zb1ev1EkiSKlQgSx7HSKIqUmZxUk8V6rUHq8Iiry5KKXRRdJblsjqwiy3lOqEjYqNfVPpPJUK1+5bZxi36p0xf/QD6Zpt7vV8zmfkNyl+B5nhgtK8Y+4VMqRTqdJiVUGhQKBXT9gmazieM4uBMb350wcSyWgUsoR5ZRfd/Hm3nCzFex/2V3Ltfyrmwoa7/jiMMfCe8rG/a/3/O2cMfYDXYJ5cXHN3hc/5+QudBFMKfYijipx3z5uVTqegF/AU7ZMHB7og+TAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;&quot;
        alt=&quot;微信web开发者工具报错&quot;
        title=&quot;&quot;
        src=&quot;/static/error-a95574b88827950db1a22f06bf11eb2b-55803.png&quot;
        srcset=&quot;/static/error-a95574b88827950db1a22f06bf11eb2b-551ed.png 175w,
/static/error-a95574b88827950db1a22f06bf11eb2b-1aa07.png 350w,
/static/error-a95574b88827950db1a22f06bf11eb2b-55803.png 700w,
/static/error-a95574b88827950db1a22f06bf11eb2b-21105.png 840w&quot;
        sizes=&quot;(max-width: 700px) 100vw, 700px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;{% img &lt;a href=&quot;https://zhulichao.github.io/2018/07/07/wechat-base3/error.png&quot;&gt;https://zhulichao.github.io/2018/07/07/wechat-base3/error.png&lt;/a&gt; 微信web开发者工具报错 %}&lt;/p&gt;
&lt;p&gt;{% img &lt;a href=&quot;https://zhulichao.github.io/2018/07/07/wechat-base3/tool.png&quot;&gt;https://zhulichao.github.io/2018/07/07/wechat-base3/tool.png&lt;/a&gt; 微信开发者工具 %}&lt;/p&gt;
&lt;p&gt;{% img &lt;a href=&quot;https://zhulichao.github.io/2018/07/07/wechat-base3/web_tool.png&quot;&gt;https://zhulichao.github.io/2018/07/07/wechat-base3/web_tool.png&lt;/a&gt; 微信web开发者工具 %}&lt;/p&gt;
&lt;h2&gt;登录授权&lt;/h2&gt;
&lt;p&gt;参考&lt;a href=&quot;https://mp.weixin.qq.com/wiki?t=resource/res_main&amp;#x26;id=mp1421140842&quot;&gt;微信网页授权&lt;/a&gt;文档，工作主要是在后端，提供一个地址供前端访问，其余工作都由后端完成。后端确保 appID、appsecret、Token 值正确，服务号设置确保接口配置信息、JS接口安全域名、授权回调页面域名正确，即可完成登录授权。前后端都需要注意哪些设置的值是带协议的，哪些是不带协议的，如果服务号设置和后端设置的 appID 等值是正确的，可能是由于多带或少带协议名返回 redirect&lt;em&gt;uri 错误。我们项目中的 API&lt;/em&gt;SERVER_URL 环境变量如果带了协议名，就会返回这个错误。在微信开发者工具中，授权是跳转到一个登录的页面，在真机上是弹框授权。&lt;/p&gt;
&lt;p&gt;因为微信网页授权其实是进行的页面跳转，在项目中如果授权后仍然停留在当前页面，但要发生一些行为，如弹框，只能通过授权后的回调地址带参数的形式。建议授权后的回调地址如果需要传参数，使用 hash 的形式传参，这是因为这个页面如果需要使用 js-sdk，在 iOS 上页面路径发生变化可能会导致 &lt;code class=&quot;language-text&quot;&gt;wx.config()&lt;/code&gt; 执行失败，但 hash 的形式不会有影响。进入页面时在 componentDidMount 中判断 url 是否带有指定的 hash 参数，有则表示是授权后进入的当前页面，执行指定的行为，然后将页面 hash 参数置空。正常情况下授权后进入页面会重新加载整个页面，也就是会执行完整的生命周期方法进入 componentDidMount 中，&lt;strong&gt;但实际中发现有些情况并没有进入 componentDidMount 方法&lt;/strong&gt;，因此在 componentDidMount 方法中添加了 hashchange 的监听，在 componentWillUnmount 中取消监听，如果在 componentDidMount 方法中需要网络请求的，也需要注意在授权返回后是否真正发起了该请求以及请求是走的网络还是缓存，可能需要进行特殊处理，就完整的解决了微信网页授权问题。&lt;/p&gt;
&lt;p&gt;微信开发者工具中可通过，清缓存 -&gt; 清除开发者工具cookie 取消授权；iOS 真机可通过微信中，我 -&gt; 设置 -&gt; 通用 -&gt; 存储空间 -&gt; 清理微信缓存，取消授权；anroid 真机可通过在微信中，打开网页 debugx5.qq.com，勾上最下面的四项 Cookie、文件缓存、广告过滤缓存、DNS缓存，点击清除取消授权。&lt;/p&gt;
&lt;p&gt;示例代码如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;
      &lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; queryString &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;query-string&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Page&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;React&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Component&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;componentDidMount&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// 判断是否是后端登录返回的&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;replaceUrl&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    window&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;addEventListener&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;hashchange&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;replaceUrl&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;componentWillUnmount&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    window&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;removeEventListener&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;hashchange&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;replaceUrl&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;replaceUrl&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;window&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; parsedHash &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; queryString&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;parse&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;window&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;location&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;hash&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;parsedHash&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;show &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;true&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        window&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;location&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;hash &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// 显示 actionSheet&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;actionSheet&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;handleShow&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; showActionSheet &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; callbackUri &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token string&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;config&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;clientUrl&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;/sharePlan#show=true`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    Router&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;push&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
      &lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token string&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;config&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;serverUrl&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;/api/weixin/auth?callbackUri=&lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;callbackUri&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;render&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// ...&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;h2&gt;js-sdk 使用&lt;/h2&gt;
&lt;p&gt;参考&lt;a href=&quot;https://mp.weixin.qq.com/wiki?t=resource/res_main&amp;#x26;id=mp1421141115&quot;&gt;微信JS-SDK说明文档&lt;/a&gt;文档，前端所有需要使用 JS-SDK 的页面必须先执行 &lt;code class=&quot;language-text&quot;&gt;wx.config()&lt;/code&gt; 注入配置信息，前端传入页面 url 给后端，后端返回 timestamp、nonceStr、signature，建议 appId 也一起由后端返回，前端就不需要自己配置 appID 了。&lt;/p&gt;
&lt;p&gt;从文档中看注入配置信息没有什么难点，在微信开发者工具、android 真机也非常顺利，但 iOS 真机处了问题，一直提示“invalid signature签名错误”，各种排查问题，后来通过复制页面连接，发现在 iOS 真机单页应用在路由切换时页面 url 一直保持不变，都是第一个打开页面的 url。因此使用了，在项目入口文件，定义一个变量保存页面 url，该变量只被赋值一次，来确保该变量保存的是初次进入页面的 url，然后通过 context 的形式传入到其它页面，在获取 wx.config 的签名参数时，判断如果是 iOS 平台，则传入 context 中的第一个打开页面的 url，否则传入当前页面 url，就解决了签名错误的问题。&lt;/p&gt;
&lt;p&gt;还有一个可能遇到的问题，通过服务号进入页面时报签名错误，复制当前网页链接直接进入则签名正确，请检查服务号菜单配置中路径是否正确，可能是路径末尾缺少一个 &lt;code class=&quot;language-text&quot;&gt;/&lt;/code&gt;。程序猿已在风中凌乱。。。&lt;/p&gt;
&lt;p&gt;示例代码如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;
      &lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// _app.tsx&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; ContextType &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  initialUrl&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; PropTypes&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;string&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; initialUrl&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MyApp&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;App&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; childContextTypes &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; ContextType&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getInitialProps&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; Component&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ctx &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; pageProps &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Component&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;getInitialProps&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      pageProps &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; Component&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getInitialProps&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ctx&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; pageProps&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; query&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ctx&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;query&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; asPath&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ctx&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;asPath &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getChildContext&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      initialUrl&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// 使用组件&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// 1.获取签名需要的页面 url&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; signUrl &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token string&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;config&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;clientUrl&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;Router&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;asPath&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// 1.1判断 ios 终端&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; userAgent &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; navigator&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;userAgent&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; isiOS &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;userAgent&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;match&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token regex&quot;&gt;/\(i[^;]+;( U;)? CPU.+Mac OS X/&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;isiOS&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    signUrl &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token string&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;config&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;clientUrl&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;initialUrl&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// 2.调用后台接口获取签名需要的参数&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; signSdkData&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; SignSdkData &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;client&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;query&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    fetchPolicy&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;network-only&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    query&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; signSdkQuery&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    variables&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      uri&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; signUrl&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// 3.进行 js-sdk 签名&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;signSdkData &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; signSdkData&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;data &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; signSdkData&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;data&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;signSdk&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; appId&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; nonceStr&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; signature&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; timestamp &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; signSdkData&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;data&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;signSdk&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    wx&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;config&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      appId&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      debug&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      jsApiList&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
        &lt;span class=&quot;token string&quot;&gt;&apos;onMenuShareAppMessage&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token string&quot;&gt;&apos;onMenuShareTimeline&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token string&quot;&gt;&apos;hideMenuItems&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token string&quot;&gt;&apos;showMenuItems&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      nonceStr&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      signature&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      timestamp&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// 4.签名成功执行回调&lt;/span&gt;
    wx&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;ready&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;callback&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;error&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;h2&gt;生产环境&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;注册服务号，进行微信认证&lt;/li&gt;
&lt;li&gt;开发者工具 -&gt; web开发者工具， 添加开发者账号，才可开发该 appID 的服务号&lt;/li&gt;
&lt;li&gt;设置 -&gt; 人员设置，添加运行人员，可登录后台和群发消息&lt;/li&gt;
&lt;li&gt;功能 -&gt; 自定义菜单，配置菜单&lt;/li&gt;
&lt;li&gt;小程序 -&gt; 小程序管理，添加关联的小程序&lt;/li&gt;
&lt;li&gt;小程序 -&gt; 展示场景，在公众号资料中展示小程序&lt;/li&gt;
&lt;li&gt;设置 -&gt; 公众号设置 -&gt; 功能设置，JS接口安全域名为前端域名，网页授权域名为后端域名，业务域名好像没用【待确定】&lt;/li&gt;
&lt;li&gt;开发 -&gt; 基本配置，IP白名单中添加后端 IP，服务器配置未启用【待确定】&lt;/li&gt;
&lt;li&gt;微信商户平台 -&gt; 产品中心 -&gt; 开发配置，设置H5支付的授权目录，注意是目录，以&lt;code class=&quot;language-text&quot;&gt;/&lt;/code&gt;结尾，如 &lt;code class=&quot;language-text&quot;&gt;http://example.com/pages/&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[Git-基础2]]></title><description><![CDATA[git diff 工作区：就是你在电脑里能看到的目录
暂存区：git add 是把文件到暂存区
本地仓库：工作区有一个隐藏目录 .git，这个不算工作区，而是 Git 的版本库 git diff 进行对比时不会对比新创建的文件。  比较当前分支与 branchName…]]></description><link>https://www.zhulichao.club/git-base2/</link><guid isPermaLink="false">https://www.zhulichao.club/git-base2/</guid><content:encoded>&lt;h2&gt;git diff&lt;/h2&gt;
&lt;p&gt;工作区：就是你在电脑里能看到的目录
暂存区：git add 是把文件到暂存区
本地仓库：工作区有一个隐藏目录 .git，这个不算工作区，而是 Git 的版本库&lt;/p&gt;
&lt;p&gt;git diff 进行对比时不会对比新创建的文件。&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;git diff branchName&lt;/code&gt; 比较当前分支与 branchName 分支
&lt;code class=&quot;language-text&quot;&gt;git diff branchName1 branchName2&lt;/code&gt; 比较 branchName1 分支与 branchName2 分支
&lt;code class=&quot;language-text&quot;&gt;git diff develop origin/develop&lt;/code&gt;  比较本地 develop 分支和远程 develop 分支的差别
&lt;code class=&quot;language-text&quot;&gt;git diff --staged&lt;/code&gt;  比较暂存区与 HEAD
&lt;code class=&quot;language-text&quot;&gt;git diff HEAD&lt;/code&gt; 比较工作区与 HEAD
&lt;code class=&quot;language-text&quot;&gt;git diff&lt;/code&gt; 比较工作区与暂存区&lt;/p&gt;
&lt;h2&gt;git commit&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;git commit&lt;/code&gt;  提交所有添加到索引库中、或从索引库删除的文件
输入 i 进入编辑状态，第一行添加的内容作为 summary 描述, 隔一个空行，再添加的内容作为 description 描述，按 esc 退出编辑状态，输入 shift + :，输入 wq，保存并提交。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;git commit -m &amp;quot;summary 描述&amp;quot;&lt;/code&gt;  提交所有添加到索引库中、或从索引库删除的文件
简化版提交命令，-m 添加 summary 描述，不能添加 description 描述。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;git commit -a&lt;/code&gt;  提交所有已在索引库中发生了修改的文件，新添加的文件不会被提交
输入 i 进入编辑状态，第一行添加的内容作为 summary 描述, 隔一个空行，再添加的内容作为 description 描述，按 esc 退出编辑状态，输入 shift + :，输入 wq，保存并提交。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;git commit --fixup [commitId]&lt;/code&gt;  提交所有添加到索引库中、或从索引库删除的文件
提交一个新的 commit，summay 为指定 commitId 的 summay 添加了 “fixup!” 前缀。在执行 &lt;code class=&quot;language-text&quot;&gt;rebase --autosquash&lt;/code&gt; 命令时针对该次 commit 的操作默认为 fixup，本次提交信息会被清除，不会进入编辑提交信息的状态。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;git commit --squash [commitId]&lt;/code&gt;  提交所有添加到索引库中、或从索引库删除的文件
提交一个新的 commit，summay 为指定 commitId 的 summay 添加了 squash!” 前缀。在执行 &lt;code class=&quot;language-text&quot;&gt;rebase --autosquash&lt;/code&gt; 命令时针对该次 commit 的操作默认为 squash，会进入编辑提交信息的状态。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;git rebase&lt;/h2&gt;
&lt;p&gt;类似于 git merge，将指定分支合并到当前分支。区别是 git merge 会创建一次新的提交记录，git rebase 不会，它会把当前分支里的每个提交取消掉，并且把它们临时保存为补丁(这些补丁放到”.git/rebase”目录中)，然后把当前分支更新为最新的指定分支，最后再把保存的这些补丁应用到当前分支上。&lt;/p&gt;
&lt;p&gt;“-i” 是指交互模式，就是说你可以干预 rebase 这个事务的过程，包括设置 commit message，删除 commit 等等。
“—autosquash” 是自动合并 commit 的参数。&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;git rebase -i --autosquash [branchName]&lt;/code&gt; 当前在特性分支上执行，合并 branchName 分支到当前分支&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;git rebase -i --autosquash [branchName] [feature]&lt;/code&gt; 无需在特性分支上执行&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;git rebase --abort&lt;/code&gt; 终止 rebase 的行动，回到 rebase 前的状态&lt;/p&gt;
&lt;p&gt;特性分支合并了最新的主分支后，原有的 commit 是逐个应用到当前分支的，当正常执行的 commit 与已有代码发生冲突时，需执行下面三部，直到 rebase 成功。&lt;/p&gt;
&lt;p&gt;① 解决冲突&lt;/p&gt;
&lt;p&gt;② &lt;code class=&quot;language-text&quot;&gt;git add .&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;③ &lt;code class=&quot;language-text&quot;&gt;git rebase --continue&lt;/code&gt;&lt;/p&gt;
&lt;h2&gt;git hooks&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;pre-commit&lt;/code&gt; 在键入提交信息前运行，被用来检查即将提交的快照，当从该挂钩返回非零值时，Git 放弃此次提交，但可以用 git commit —no-verify 来忽略&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;prepare-commit-msg&lt;/code&gt; 在提交信息编辑器显示之前，默认信息被创建之后运行，该挂钩对通常的提交来说不是很有用，只在自动产生默认提交信息的情况下有作用，如提交信息模板、合并、压缩和修订提交等&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;commit-msg&lt;/code&gt; 接收一个参数，此参数是包含最近提交信息的临时文件的路径，如果该挂钩脚本以非零退出，Git 放弃提交，可以用来在提交通过前验证项目状态或提交信息&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;post-commit&lt;/code&gt; 挂钩在整个提交过程完成后运行，作为通知之类使用的&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;pre-rebase&lt;/code&gt; 在衍合前运行，脚本以非零退出可以中止衍合的过程，可以使用这个挂钩来禁止衍合已经推送的提交对象&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;post-rewrite&lt;/code&gt; 被那些会替换提交记录的命令调用，如 git commit —amend 和 git rebase&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;post-checkout&lt;/code&gt; git checkout 成功运行后，该挂钩会被调用，可以用来为你的项目环境设置合适的工作目录&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;post-merge&lt;/code&gt; 在merge命令成功执行后，该挂钩会被调用，可以用来在 Git 无法跟踪的工作树中恢复数据&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;pre-push&lt;/code&gt; 会在 git push 运行期间，更新了远程引用但尚未传送对象时被调用，可以在推送开始之前，用它验证对引用的更新操作&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;cd .git/hooks&lt;/code&gt; 可查看 git 所有 hooks&lt;/p&gt;
&lt;h2&gt;git fork 机制&lt;/h2&gt;
&lt;p&gt;使用场景：如果想要修改他人 github 的项目，直接 clone 代码到本地是不能 pull 或 push 的，所以要使用 fork，先把他人代码 fork 到自己的 github 仓库，然后 clone 到本地修改，然后再提交到自己 github 仓库，这时候想要把修改的代码提交给他人的话，就可以在自己的 github 上提交 pull request，等其他人看到后就可以把代码做一个合并。当他人的代码有更新的时候，也可以将更新同步到自己的 github 仓库。&lt;/p&gt;
&lt;h4&gt;github 的 fork&lt;/h4&gt;
&lt;p&gt;在 github 上，fork 一个项目，如 lodash，如果远程有更新，红框内会有提示，点击 Pull request，base fork 选则本地仓库，head fork 选则 lodash 仓库，可将 lodash 的更新通过一个 pull request 合并到自己的仓库中。也可以通过交换 base fork 和 head fork 提交一个 pull request 到 lodash 仓库。&lt;/p&gt;
&lt;p&gt;{% img &lt;a href=&quot;https://zhulichao.github.io/2018/05/04/git-base2/fork-1.png&quot;&gt;https://zhulichao.github.io/2018/05/04/git-base2/fork-1.png&lt;/a&gt; fork 一个项目 %}&lt;/p&gt;
&lt;p&gt;{% img &lt;a href=&quot;https://zhulichao.github.io/2018/05/04/git-base2/fork-2.png&quot;&gt;https://zhulichao.github.io/2018/05/04/git-base2/fork-2.png&lt;/a&gt; 提交 pull request %}&lt;/p&gt;
&lt;p&gt;{% img &lt;a href=&quot;https://zhulichao.github.io/2018/05/04/git-base2/fork-3.png&quot;&gt;https://zhulichao.github.io/2018/05/04/git-base2/fork-3.png&lt;/a&gt; git remote -v %}&lt;/p&gt;
&lt;h4&gt;git 命令&lt;/h4&gt;
&lt;p&gt;在 github 创建一个仓库命名为 local-lodash 后，执行下面操作：
&lt;code class=&quot;language-text&quot;&gt;git clone https://github.com/lodash/lodash.git local-lodash&lt;/code&gt; 克隆远程 lodash 仓库到本地
&lt;code class=&quot;language-text&quot;&gt;git remote remove origin&lt;/code&gt; 删除远程仓库地址
&lt;code class=&quot;language-text&quot;&gt;git remote add origin https://github.com/zhulichao/local-lodash.git&lt;/code&gt; 添加自己的远程仓库地址
&lt;code class=&quot;language-text&quot;&gt;git remote add upstream https://github.com/lodash/lodash.git&lt;/code&gt; 添加上游远程仓库地址
&lt;code class=&quot;language-text&quot;&gt;git push -u origin master&lt;/code&gt; 初次提交到自己的远程仓库
&lt;code class=&quot;language-text&quot;&gt;git pull upstream master&lt;/code&gt; 同步上游仓库 lodash 的更新
&lt;code class=&quot;language-text&quot;&gt;git push origin&lt;/code&gt; 提交到自己的远程仓库
&lt;code class=&quot;language-text&quot;&gt;git remote -v&lt;/code&gt;  查看远程仓库地址，pull 和 push 可以是两个不同的地址&lt;/p&gt;
&lt;p&gt;{% img &lt;a href=&quot;https://zhulichao.github.io/2018/05/04/git-base2/fork-4.png&quot;&gt;https://zhulichao.github.io/2018/05/04/git-base2/fork-4.png&lt;/a&gt; git remote -v %}&lt;/p&gt;
&lt;p&gt;这种方式与在 github 上执行 fork 还是有区别的，如图所示，没有上面图片中红框中的内容，在 github 上是无法通过 pull request 同步远程 lodash 更新的，当然也不能提交 pull request 到远程 lodash，只能通过上面的命令 &lt;code class=&quot;language-text&quot;&gt;git pull upstream master&lt;/code&gt; 同步远程 lodash 的更新。如果你恰好也是远程 lodash 的贡献者，也可以通过 &lt;code class=&quot;language-text&quot;&gt;git push upstream master&lt;/code&gt; 直接提交 commit 到 远程 lodash。&lt;/p&gt;
&lt;p&gt;{% img &lt;a href=&quot;https://zhulichao.github.io/2018/05/04/git-base2/fork-5.png&quot;&gt;https://zhulichao.github.io/2018/05/04/git-base2/fork-5.png&lt;/a&gt; github 上查看 %}
{% img &lt;a href=&quot;https://zhulichao.github.io/2018/05/04/git-base2/fork-6.png&quot;&gt;https://zhulichao.github.io/2018/05/04/git-base2/fork-6.png&lt;/a&gt; 提交 pull request %}&lt;/p&gt;</content:encoded></item><item><title><![CDATA[微信小程序基础2]]></title><description><![CDATA[开发过程中的发现 wx:for 可以变量对象，wx:for-index 为对象的 key，wx:for-item 为对象的值 wx.getBackgroundAudioManager() 获取到的值，是可能随时发生变化的，如下情况的代码，在两次输出时可能会返回不同的值 WXML…]]></description><link>https://www.zhulichao.club/wechat-base2/</link><guid isPermaLink="false">https://www.zhulichao.club/wechat-base2/</guid><content:encoded>&lt;h2&gt;开发过程中的发现&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;wx:for 可以变量对象，wx:for-index 为对象的 key，wx:for-item 为对象的值&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;wx.getBackgroundAudioManager() 获取到的值，是可能随时发生变化的，如下情况的代码，在两次输出时可能会返回不同的值&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;
      &lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;const backgroundAudioManager = wx.getBackgroundAudioManager();
console.log(backgroundAudioManager.src);
...
console.log(backgroundAudioManager.src);&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;WXML 中参数命名为 data-live-id，在 js 中调用的事件处理函数中通过参数 e.target.dataset.liveId 获取；命名为 data-liveId，通过参数 e.target.dataset.liveid 获取&lt;/li&gt;
&lt;li&gt;scroll-view 设置 scroll-into-view 有时候没有效果，目前已知在先设置了 scroll-into-view 值，但是页面由于数据的处理还没有完成进行的是初始空列表的渲染，此时无法滚动到指定位置&lt;/li&gt;
&lt;li&gt;在点击页面返回按钮时如果想指定返回层级数，可以在 onUnload() 生命周期方法中，调用 getCurrentPages() 获取整个路由栈中的所有信息，来决定返回返回几级页面 &lt;code class=&quot;language-text&quot;&gt;wx.navigateBack({ delta: 1 });&lt;/code&gt;，但是可能存在中间页面显示一下就消失的效果&lt;/li&gt;
&lt;li&gt;图片的名称不要用汉字，在真机上（华为荣耀8）可能找不到资源&lt;/li&gt;
&lt;li&gt;对于图片高度未知的情况，可能存在图片被压缩了然后又正常显示的情况，可以设置图片的 &lt;code class=&quot;language-text&quot;&gt;height: auto;&lt;/code&gt; 或者添加 image 组件的 bindload 回调，控制图片在加载完成后再显示出来&lt;/li&gt;
&lt;li&gt;如果有富文本的内容需要后端返回，因为 web-view 有一些限制，为了降低开发成本可以使用长图的形式&lt;/li&gt;
&lt;li&gt;onUnload 是页面元素已经卸载后的回调，目前小程序没有提供页面元素卸载前的回调，如果在 onUnload 中进行获取页面元素的操作可能会报错&lt;/li&gt;
&lt;li&gt;官方文档中描述，wx:if 有更高的切换消耗而 hidden 有更高的初始渲染消耗，如果需要频繁切换的情景下，用 hidden 更好，如果在运行时条件不大可能改变则 wx:if 较好&lt;/li&gt;
&lt;li&gt;确定了在 android 手机（华为荣耀8），临时文件和保存文件的存储路径，在文件系统是可以看到的，路径如下，其中 &lt;code class=&quot;language-text&quot;&gt;wx2a4a59eb34efaf3b&lt;/code&gt; 为 appid，&lt;code class=&quot;language-text&quot;&gt;tmp_&lt;/code&gt; 表示临时文件，&lt;code class=&quot;language-text&quot;&gt;store_&lt;/code&gt; 表示保存的文件，也就说明如果使用了文件的存储，需要处理文件被用户手动删除的处理
&lt;code class=&quot;language-text&quot;&gt;/Tecent/MicroMsg/wxafiles/wx2a4a59eb34efaf3b/tmp_df3c24e50376e0354dc22798e6dccfda9e88f20b6d7ed0e0.jpg&lt;/code&gt;
&lt;code class=&quot;language-text&quot;&gt;/Tecent/MicroMsg/wxafiles/wx2a4a59eb34efaf3b/store_df3c24e50376e0354dc22798e6dccfda9e88f20b6d7ed0e0.jpg&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;100vh 指的是去掉顶部 Header 和底部 TabBar (如果存在) 后的高度，wx.getSystemInfo() 返回的理论上也是去掉顶部 Header 和底部 TabBar (如果存在) 后的高度，但存在适配问题，在 android 机上不同页面调用可能返回不同的值&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;一个值得思考的 bug&lt;/h2&gt;
&lt;p&gt;问题描述：A 页面 -&gt; B 页面 -&gt; C 页面，在 C 页面中，进行背景音频播放，并添加了背景音频播放的监听，onPlay、onPause、onTimeUpdate、onEnded、onStop，这些监听中主要是更新当前页面的 data 值，来控制页面中的显示，如显示播放/暂停按钮，显示当前播放进度等，&lt;strong&gt;并更新全局的当前播放音频的信息&lt;/strong&gt;，在从 C 页面返回到 B 页面及 A 页面时，会显示一个悬浮播放的控件，显示正在播放的背景音频的信息及播放进度。问题是在从 C 页面返回后，如果是从背景音频点击的暂停，悬浮播放控件中显示的当前播放进度会显示从 C 页面返回时的进度，而不是当前播放进度。&lt;/p&gt;
&lt;p&gt;分析原因：经过大概1小时的 bug 追踪，发现问题的原因是背景音频播放的监听是在 C 页面内的，在 onPause 监听中，更新全局播放音频信息的代码是如下代码中的第一段，但从 C 页面返回后，C 页面已经销毁了，这时再获取 this.data.tipRecord 是销毁页面前的数据（刚开始这么写的时候我以为会报错），也就是从 C 返回时的数据。将代码修改为第二段，主要是更新全局提示记录的处理是基于全局 store 中的数据，而不是当前页面的 data，该问题就解决了。&lt;/p&gt;
&lt;p&gt;在 C 页面中的音频播放监听方法：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;
      &lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;// 第一段，有问题的
this.backgroundAudioManager.onPause(() =&amp;gt; {
    // 全局提示记录处理，更新 store 中的全局信息
    this.setTipRecord({
        ...this.data.tipRecord,
        show: true,
        paused: true,
    });
});

// 第二段，修正后的
this.backgroundAudioManager.onPause(() =&amp;gt; {
    // 获取全局 store 中的音频播放信息
    const storeData = this.store.getState();
    // 全局提示记录处理，更新 store 中的全局信息
    this.setTipRecord({
        ...storeData.tipRecord,
        show: true,
        paused: true,
    });
});&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;h2&gt;参考组件&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://gitee.com/SolitaryAngel/doomm&quot;&gt;弹幕 doomm&lt;/a&gt;
&lt;a href=&quot;https://github.com/GeoffZhu/wepy-swipe-delete&quot;&gt;滑动删除 wepy-swipe-delete（考虑封装）&lt;/a&gt;
&lt;a href=&quot;https://github.com/jingle1267/demo&quot;&gt;小程序官方示例&lt;/a&gt;
&lt;a href=&quot;https://github.com/charleyw/wechat-weapp-redux&quot;&gt;小程序 Redux 绑定库&lt;/a&gt;
&lt;a href=&quot;https://github.com/icindy/wxParse&quot;&gt;富文本解析 wxParse（考虑改为 ts）&lt;/a&gt;
&lt;a href=&quot;https://www.jianshu.com/p/c681007a6287&quot;&gt;可滑动 tabs（考虑封装）&lt;/a&gt;
&lt;a href=&quot;https://github.com/youzan/zanui-weapp&quot;&gt;赞组件库 zanui-weapp&lt;/a&gt;
&lt;a href=&quot;https://github.com/meili/minui&quot;&gt;MinUI 组件库&lt;/a&gt;
&lt;a href=&quot;https://github.com/wenshan/iwebchat&quot;&gt;wepy基础 UI 组件&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;声明周期方法&lt;/h2&gt;
&lt;p&gt;// 初始化，显示 Page1 页面
App === onLaunch
App === onShow
Page1 === onLoad
Page1 === onShow
Page1 === onReady&lt;/p&gt;
&lt;p&gt;// 跳转到 Page2 页面
Page1 === onHide
Page2 === onLoad
Page2 === onShow
Page2 === onReady&lt;/p&gt;
&lt;p&gt;// 从 Page2 返回 Page1 页面
Page2 === onUnload
Page1 === onShow&lt;/p&gt;
&lt;p&gt;// 切后台
Page1 === onHide
App === onHide&lt;/p&gt;
&lt;h2&gt;自定义 Component&lt;/h2&gt;
&lt;p&gt;自定义 Component 需要注意的主要是 Component 中调用调用处 Page 的方法的方式，以及自定义子组件的传入方式。&lt;/p&gt;
&lt;h4&gt;Page 的代码&lt;/h4&gt;
&lt;p&gt;page.json&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;
      &lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;{
  &amp;quot;usingComponents&amp;quot;: {
    &amp;quot;voice&amp;quot;: &amp;quot;/components/voice/voice&amp;quot;,
  }
}&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;page.js&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;
      &lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Page({
    ...
    handleVoiceSeek(e) {
        // e.detail 内是 Component 传入的参数，还可通过 e.target.dataset.src 获取调用组件时传入的 data-src 参数
        this.backgroundAudioManager.seek(e.detail.value);
    },
});&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;page.wxml&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;
      &lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;&amp;lt;view&amp;gt;
    &amp;lt;voice
        data-src=&amp;quot;{{particle.audio.uri}}&amp;quot;
        bind:_handleVoiceSeek=&amp;quot;handleVoiceSeek&amp;quot;
        src=&amp;quot;{{particle.audio.uri}}&amp;quot;
        playing=&amp;quot;{{true}}&amp;quot;
        currentTime=&amp;quot;{{particle.audio.currentTime}}&amp;quot;
        duration=&amp;quot;{{particle.audio.duration}}&amp;quot;
        formatedCurrentTime=&amp;quot;{{particle.audio.formatedCurrentTime}}&amp;quot;
        formatedEndedTime=&amp;quot;{{particle.audio.formatedEndedTime}}&amp;quot;
    &amp;gt;
        &amp;lt;view slot=&amp;quot;content&amp;quot;&amp;gt;这里是插入到组件slot中的内容&amp;lt;/view&amp;gt;
    &amp;lt;/voice&amp;gt;
&amp;lt;/view&amp;gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;h4&gt;Component 的代码&lt;/h4&gt;
&lt;p&gt;component.json&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;
      &lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;{
  &amp;quot;component&amp;quot;: true
}&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;component.ts&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;
      &lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Component({
  options: {
    multipleSlots: true, // 在组件定义时的选项中启用多slot支持
  },
  methods: {
    _handleSeek(e) {
        // 此处的参数 e 是 slider 传入的，触发调用处的 bind:_handleVoiceSeek 对应的 js 中定义的方法并传入参数，也就是调用 handleVoiceSeek 方法
        this.triggerEvent(&amp;#39;_handleVoiceSeek&amp;#39;, { value: e.detail.value });
    },
  },
  properties: {
    src: {
      type: String,
    },
    playing: {
      type: Boolean,
    },
    currentTime: {
      type: Number,
    },
    duration: {
      type: Number,
    },
    formatedCurrentTime: {
      type: String,
    },
    formatedEndedTime: {
      type: String,
    },
  },
});&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;component.wxml&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;
      &lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;&amp;lt;view class=&amp;quot;container&amp;quot;&amp;gt;
    &amp;lt;image wx:if=&amp;quot;{{playing}}&amp;quot; class=&amp;quot;icon&amp;quot; src=&amp;quot;/images/pause.png&amp;quot; /&amp;gt;
    &amp;lt;image wx:else class=&amp;quot;icon&amp;quot; src=&amp;quot;/images/play.png&amp;quot; /&amp;gt;
    &amp;lt;view class=&amp;quot;sliderContainer&amp;quot;&amp;gt;
        &amp;lt;slider min=&amp;quot;0&amp;quot; max=&amp;quot;{{duration}}&amp;quot; value=&amp;quot;{{currentTime}}&amp;quot; bindchange=&amp;quot;_handleSeek&amp;quot; /&amp;gt;
        &amp;lt;view class=&amp;quot;time&amp;quot;&amp;gt;
            &amp;lt;text&amp;gt;{{formatedCurrentTime}}&amp;lt;/text&amp;gt;
            &amp;lt;text&amp;gt;{{formatedEndedTime}}&amp;lt;/text&amp;gt;
        &amp;lt;/view&amp;gt;
    &amp;lt;/view&amp;gt;
    &amp;lt;slot name=&amp;quot;content&amp;quot; /&amp;gt;
&amp;lt;/view&amp;gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;h2&gt;探索页面卸载前的监听、页面返回监听、退出小程序监听&lt;/h2&gt;
&lt;p&gt;目前小程序未提供这些功能！&lt;/p&gt;
&lt;h2&gt;探索是否自定义 Header 和 TabBar&lt;/h2&gt;
&lt;p&gt;在有些场景使用官方提供的 Header 和 TabBar 可能无法满足需求，官方会说可以使用自定的形式，但我查了下社区自定义可能存在不好处理的兼容性问题、android 原生事件无法监听的问题。如果没有真的特别需要、必须自定义，暂时还是不要自定义了。&lt;/p&gt;
&lt;h2&gt;探索小程序运行原理&lt;/h2&gt;
&lt;p&gt;微信小程序运行在三端：iOS、Android 和 开发者工具。在 iOS 上，小程序的 javascript 代码是运行在 JavaScriptCore 中（苹果开源的浏览器内核）；在 Android 上，小程序的 javascript 代码是通过 X5 内核来解析（QQ浏览器内核），X5 对 ES6 的支持不好，要兼容的话，可以使用 ES5 或者引入 babel-polyfill 兼容库；在开发工具上，小程序的 javascript 代码是运行在 nwjs（chrome内核）。&lt;/p&gt;
&lt;p&gt;微信开发者工具编辑器的实现原理和方式：它本身也是基于WEB技术体系实现的，nwjs + react，nwjs 简单说就是node + webkit，node提供给本地api能力，webkit提供web能力，两者结合就能使用JS+HTML实现本地应用程序，wxml 转化为 html用的是 reactjs，包括里面整套的逻辑都是建构在 reactjs 之上的。既然有nodejs，打包时ES6转ES5可引入babel-core的node包，CSS补全可引入postcss和autoprefixer的node包（postcss和autoprefixer的原理看这里），代码压缩可引入uglifyjs的node包。&lt;/p&gt;
&lt;p&gt;微信小程序的 JavaScript 运行环境即不是 Browser 也不是 Node.js。它运行在微信 App 的上下文中，不能操作 Browser context 下的 DOM，也不能通过 Node.js 相关接口访问操作系统 API。所以，严格意义来讲，微信小程序并不是 Html5，尽管开发过程和用到的技术栈和 Html5 是相通的。开发者写的所有代码最终将会打包成一份 JavaScript，并在小程序启动的时候运行，直到小程序销毁。&lt;/p&gt;
&lt;p&gt;小程序的视图层目前使用 WebView 作为渲染载体，而逻辑层是由独立的 JavascriptCore 作为运行环境。在架构上，WebView 和 JavascriptCore 都是独立的模块，并不具备数据直接共享的通道。当前，视图层和逻辑层的数据传输，实际上通过两边提供的 evaluateJavascript 所实现。即用户传输的数据，需要将其转换为字符串形式传递，同时把转换后的数据内容拼接成一份 JS 脚本，再通过执行 JS 脚本的形式传递到两边独立环境。但是 evaluateJavascript 的执行会受很多方面的影响，数据到达视图层并不是实时的。&lt;/p&gt;
&lt;p&gt;小程序代码包经过编译后，会放在微信的 CDN 上供用户下载，CDN 开启了 GZIP 压缩，所以用户下载的是压缩后的 GZIP 包，其大小比代码包原体积会更小。目前小程序打包是会将工程下所有文件都打入代码包内，也就是说，这些没有被实际使用到的库文件和资源也会被打入到代码包里，从而影响到整体代码包的大小。小程序启动时会从CDN下载小程序的完整包，一般是数字命名的，如：&lt;em&gt;-2082693788&lt;/em&gt;4.wxapkg。&lt;/p&gt;
&lt;p&gt;小程序正式部署使用 webpack 打的包，而在打包的过程中，把以下变量给屏蔽了：&lt;code class=&quot;language-text&quot;&gt;window,document,frames,self,location,navigator,localStorage,history,Caches,screen,alert,confirm,prompt,XMLHttpRequest,WebSocket&lt;/code&gt;。主要是为了管理和监控，如果这些对象你能访问，就可以像操作通常的网页一样操作小程序，这是绝对不被允许的。&lt;/p&gt;
&lt;p&gt;{% img &lt;a href=&quot;https://zhulichao.github.io/2018/04/08/wechat-base2/folder.png&quot;&gt;https://zhulichao.github.io/2018/04/08/wechat-base2/folder.png&lt;/a&gt; 小程序打包后的结构 %}&lt;/p&gt;
&lt;p&gt;所有的小程序最后基本都被打成上面的结构，其中：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;WAService.js 框架JS库，提供逻辑层基础的API能力&lt;/li&gt;
&lt;li&gt;WAWebview.js 框架JS库，提供视图层基础的API能力&lt;/li&gt;
&lt;li&gt;WAConsole.js 框架JS库，控制台&lt;/li&gt;
&lt;li&gt;app-config.js 小程序完整的配置，包含我们通过app.json里的所有配置，综合了默认配置型&lt;/li&gt;
&lt;li&gt;app-service.js 我们自己的JS代码，全部打包到这个文件&lt;/li&gt;
&lt;li&gt;page-frame.html 小程序视图的模板文件，所有的页面都使用此加载渲染，且所有的WXML都拆解为JS实现打包到这里&lt;/li&gt;
&lt;li&gt;pages 所有的页面，这个不是我们之前的wxml文件了，主要是处理WXSS转换，使用js插入到header区域&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;微信小程序的框架包含两部分：AppView视图层，AppService逻辑层。AppView层用来渲染页面结构，所有的视图（wxml和wxss）都是单独的 WebView来承载。AppService层用来逻辑处理、数据请求、接口调用，整个小程序只有一个，并且整个生命周期常驻内存。它们在两个进程（两个 WebView）里运行，所以小程序打开至少就会有2个 WebView进程，由于每个视图都是一个独立的 WebView进程，考虑到性能消耗，小程序不允许打开超过5个层级的页面，当然同是也是为了体验更好。使用消息 publish 和 subscribe 机制实现两个 WebView之间的通信，实现方式就是统一封装一个 WeixinJSBridge 对象，而不同的环境封装的接口不一样。&lt;/p&gt;
&lt;p&gt;对逻辑和UI进行了完全隔离，这个跟当前流行的react，agular，vue有本质的区别，小程序逻辑和UI完全运行在2个独立的WebView里面，而后面这几个框架还是运行在一个 WebView 里面的，如果你想还是可以直接操作 dom 对象进行 ui 渲染的。&lt;/p&gt;
&lt;p&gt;微信自己写了2个工具：wcc 把 WXML 转换为 VirtualDOM；wcsc 把 WXSS 转换为一个 JS 字符串的形式通过 style 标签append 到 header 里。&lt;/p&gt;
&lt;h2&gt;探索图片适配问题&lt;/h2&gt;
&lt;p&gt;方式一：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;
      &lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;@media  (-webkit-min-device-pixel-ratio: 2),(min-device-pixel-ratio: 2){
  .imgTest{
    background: url(https://images/2x.png) no-repeat;
  }
}
@media  (-webkit-min-device-pixel-ratio: 3),(min-device-pixel-ratio: 3){
  .imgTest{
    background: url(https://images/3x.png) no-repeat;
  }
}&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;方式二：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;
      &lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;// 获取设备像素比，在 wxml 中根据不同像素比显示不同图片
const getPixelRatio = () =&amp;gt; {
  let pixelRatio = 0
  wx.getSystemInfo({
    success: function (res) {
      pixelRatio = res.pixelRatio
    },
    fail: function () {
      pixelRatio = 0
    }
  })
  return pixelRatio
}&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;方式三：
只使用三倍图，或者说最大尺寸的图片，在样式中指定宽高。我个人和团队的 UI 设计师都倾向于使用这种方式，因为小程序限制上传代码的大小为 2M，尽量不使用多套图片，使用 UI 切好的大尺寸的图片在小尺寸手机上效果也不会有太大影响。&lt;/p&gt;
&lt;h2&gt;不同类型图片的适用场景&lt;/h2&gt;
&lt;p&gt;GIF（图形交换格式）：是位图的一种，但与JPEG或PNG不同，GIF文件最多使用来自256种颜色的色板中的颜色，虽然256种可能听起来像很多蜡笔，但复杂的照片通常有数千种色调。此颜色范围在GIF转换过程中丢失，而这也是彩色照片不使用GIF格式的关键原因。但是256色的限制可以帮助保持较小的文件大小，这对于即使是最慢的互联网速度也是理想的。无损，提供了网络透明度选项，适用于简单的动画、小图标、低像素间变化的图形（即大量的平面颜色，如标志和旗帜）。&lt;/p&gt;
&lt;p&gt;JPEG（联合图像专家组）：可以将此格式称为“JPEG”或“JPG”，是一种16位格式，可以通过混合红色、蓝色和绿色光来显示数百万的颜色。这使得JPG非常“相片友好”。这就是为什么当涉及到市场上大多数的数码相机时，它会是一个标准格式的部分原因。JPEG格式还允许您灵活选择压缩图像的程度——从0％（重压缩）到100％（无压缩）。60％-75％的压缩程度会大幅缩减文件大小，同时能使您的图像在大多数屏幕看起来无差别。有损，不能保留透明度，适用于静止图像、摄影、图像具有复杂的颜色和动态。&lt;/p&gt;
&lt;p&gt;PNG（便携式网络图形）：就像GIF和JPEG格式之间的结合，PNG-8格式与GIF相似，使用256色板，PNG-24与JPEG相似，允许用数百万种颜色来渲染图像。无损，提供了保留透明度选项，适用于需要透明度的Web图形、颜色重和复杂的照片和图形、需要重新编辑和重新导出的图片。&lt;/p&gt;
&lt;p&gt;SVG（可缩放向量图形）：不是纯位图格式，是一个矢量格式。基于XML的标记，可以在任何文本编辑器中编辑，并通过JavaScript或CSS修改。因为矢量可以缩放到任何大小，同时保持清晰的图像质量，它们是响应设计的理想选择。SVG文件中嵌入位图图形是有可能的，正如在HTML中嵌入JPEG图片，这给了SVG无可挑剔的灵活性和力量。矢量/无损，适合显示在矢量图形应用程序（如Illustrator，Sketch和Inkscape）中制作的徽标，图标，地图，标记，图表和其他图形，视网膜屏幕显示。&lt;/p&gt;
&lt;h2&gt;探索样式中不同单位的区别 px、rpx、rem、pt 等（待完成）&lt;/h2&gt;
&lt;p&gt;在显示屏上，每一个画面都是由无数的点阵形成的，这个点阵中，每一个点叫做像素，就是 pixel（缩写为 px），1px 所能代表的尺寸并非是一成不变的，同样 px 尺寸的元素，在高分屏上显示会明显要比在低分屏显得更小。css 中的 px 单位，是多个设备像素，1个css像素所对应的物理像素个数是不一致的，每英寸的像素的数量保持在96左右，因此设置为12px的元素，无论使用什么样的设备查看网页，字体的大小始终为1/8英寸。&lt;/p&gt;
&lt;p&gt;px 像素，是一个点，点的大小是会变的，也称“相对长度”
pt 全称 point，1/72英寸，用于印刷业，也称“绝对长度”
dp = px * (目标设备 dpi 分辨率 / 160)
rpx = px * (目标设备宽 px 值 / 750)
rem: 规定屏幕宽度为20rem；1rem = (750/20)rpx&lt;/p&gt;
&lt;p&gt;dp 是以屏幕分辨率为基准的动态单位，而 rpx 是以长度为基准的动态单位，两者是不能直接进行互换的。&lt;/p&gt;
&lt;p&gt;如果将微信小程序放到平板电脑上运行，屏幕的宽度 px 值有可能会变化（横竖屏、分屏模式等等），这时候，再以宽度为基准，就会出现元素显示不正确的问题，从这一点可以看出，微信团队目前并不希望将小程序扩展到手机以外的设备中。&lt;/p&gt;
&lt;h2&gt;多屏适配&lt;/h2&gt;</content:encoded></item></channel></rss>